# 全面审查实施计划（问题清单优先）

- 日期：2026-02-19
- 前置：`docs/plans/2026-02-19-comprehensive-review-design.md`
- 目标：产出可执行的全仓深度问题清单（先找后修）

## 阶段与里程碑

## Phase 0 - 基线准备

1. 确认当前分支与工作区状态
2. 建立审查记录模板（P0-P3 + 证据）
3. 执行基础静态检查（`pnpm typecheck`、`pnpm build`）

里程碑：形成“基线问题集（编译/类型/构建）”

## Phase 1 - Layer 1/2（基础层 + 接口层）

1. 核对依赖、脚本、环境变量与部署配置一致性
2. 逐路由检查 `app/api/**`
- 鉴权与会话控制
- 输入校验与参数边界
- 错误码与响应结构一致性
- 限流与防滥用
- 流式接口的中断和异常回传
3. 对照 `docs/API.md` 做契约一致性核验

里程碑：输出“接口与安全问题清单（初版）”

## Phase 2 - Layer 3/4（业务层 + 表现层）

1. MBTI 计算与核心流程正确性审查
2. 题目、结果、档案、历史数据流一致性审查
3. 关键页面状态机审查（加载/成功/失败/空态）
4. 多语言资源与页面文案一致性审查

里程碑：输出“业务与前端问题清单（初版）”

## Phase 3 - Layer 5（工程层）

1. 模块边界与重复实现识别
2. 类型安全与错误处理统一性审查
3. 测试缺口分析（重点覆盖 P0/P1 对应最小回归用例）

里程碑：输出“可维护性与测试缺口清单”

## Phase 4 - 汇总与分级

1. 合并去重所有问题
2. 严重级别分级（P0-P3）
3. 生成风险矩阵（概率 × 影响）
4. 生成修复批次建议（Batch 1/2/3）
5. 生成最小回归测试建议

里程碑：交付最终审查报告

## 输出格式（固定）

每条问题统一字段：
1. 标题
2. 严重级别（P0-P3）
3. 位置（文件 + 行号）
4. 证据（复现步骤或代码依据）
5. 影响
6. 修复建议（最小改动）
7. 回归建议

## 执行顺序与并行策略

1. 先基础后业务，避免误判
2. 同层可并行：
- API 路由按目录并行走查
- 页面按关键链路并行走查
3. 汇总阶段统一去重与分级

## 风险与缓解

1. 外部 AI Provider 依赖无法在线验证
- 缓解：按代码与契约先定位风险，标记“需真实密钥复验”

2. 流式行为难以稳定复现
- 缓解：以协议与异常分支代码为主证据，辅以最小本地复验

3. 文档与实现可能存在时间差
- 缓解：文档冲突单独归类为“契约漂移问题”

## 完成定义（DoD）

1. 全仓五层审查完成
2. 输出 P0-P3 问题清单并附证据
3. 输出风险矩阵与修复批次建议
4. 输出 P0/P1 最小回归测试建议
5. 明确未覆盖项与外部依赖验证项
